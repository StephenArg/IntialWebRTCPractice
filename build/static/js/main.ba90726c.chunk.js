(this["webpackJsonpwebrtc-practice-site"]=this["webpackJsonpwebrtc-practice-site"]||[]).push([[0],{31:function(e,t,n){e.exports=n(70)},36:function(e,t,n){},38:function(e,t,n){},66:function(e,t){},70:function(e,t,n){"use strict";n.r(t);var o=n(0),a=n.n(o),r=n(28),c=n.n(r),i=(n(36),n(1)),l=n.n(i),s=n(6),u=n(2),d=(n(38),n(29)),f=n.n(d);function m(e){var t=e.users,n=e.handleUserClick,o=t.map((function(e){return a.a.createElement("li",{key:e,onClick:n,style:{cursor:"pointer"}},e)}));return a.a.createElement("div",null,a.a.createElement("ul",{style:{listStyleType:"none"}},o))}var g=n(30);console.log("".concat(window.location.origin));var h,v,p,b,y,E,w,O=f()(window.location.origin.replace(/^http/,"ws")),I=[],S={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",username:"webrtc@live.com",credential:"muazkh"}]},k={video:!0,audio:!0},j=!1,D=!1;var C=function(){var e=Object(o.useState)(null),t=Object(u.a)(e,2),n=t[0],r=t[1],c=Object(o.useState)([]),i=Object(u.a)(c,2),d=i[0],f=i[1],C=Object(o.useState)(null),T=Object(u.a)(C,2),x=T[0],_=T[1],U=Object(o.useState)(!1),B=Object(u.a)(U,2),R=B[0],N=B[1],J=Object(o.useState)("Start ScreenShare"),L=Object(u.a)(J,2),M=L[0],V=L[1],A=Object(o.useState)(!1),P=Object(u.a)(A,2),G=P[0],H=P[1],W=Object(o.useState)(!1),z=Object(u.a)(W,2),F=(z[0],z[1],Object(o.useState)(!1)),Y=Object(u.a)(F,2),K=(Y[0],Y[1]);Object(o.useEffect)((function(){fetch("https://geolocation-db.com/json/").then((function(e){return e.json()})).then((function(e){console.log(e);var t=e.state?"".concat(e.state,", ").concat(e.country_name):"".concat(e.country_name);w=t})),$(),Object(g.setInterval)((function(){$()}),347e4),O.on("get_id",(function(e){console.log("Connected to websocket"),r(e.myID),f(e.users)}))}),[]),Object(o.useEffect)((function(){n&&(O.on("new_person",(function(e){f(e.filter((function(e){return e!==n})))})),O.on("remove_user",(function(e){f(e.filter((function(e){return e!==n})))})),O.on("incoming_offer",function(){var e=Object(s.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Incoming offer from ".concat(t.offersID,": ").concat(JSON.stringify(t.offer))),y=t.offersID,_(t.location),e.next=5,navigator.mediaDevices.getUserMedia(k);case 5:v=e.sent,ee(),h=new RTCPeerConnection(S),v.getTracks().forEach((function(e){var t=h.addTrack(e,v);I.push(t)})),h.ondatachannel=ae,h.setRemoteDescription(t.offer),h.ontrack=te,h.onicecandidate=ne,h.onnegotiationneeded=re,Q(!1),document.getElementById("otherID").value=JSON.stringify(t.offer);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),O.on("incoming_answer",(function(e){D=!0,_(e.location),console.log("Incoming answer: ".concat(JSON.stringify(e.answer))),h.setRemoteDescription(e.answer),document.getElementById("otherID").value=JSON.stringify(e.answer),console.log(h),N(!0),setTimeout((function(){H(!0)}),3e3)})),O.on("incoming_candidate",(function(e){console.log("candidate",e),h&&h.addIceCandidate(new RTCIceCandidate(e))})),O.on("incoming_renegotiation_offer",(function(e){console.log(e),console.log(h),h.setRemoteDescription(e.offer),Q(!0,e),document.getElementById("otherID").value=JSON.stringify(e.offer)})),O.on("incoming_renegotiation_answer",(function(e){console.log(e),h.setRemoteDescription(e.answer),document.getElementById("otherID").value=JSON.stringify(e.answer)})))}),[n]),Object(o.useEffect)((function(){G&&(j=!0)}),[G]);var $=function(){fetch("".concat(window.location.origin,"/ice_servers")).then((function(e){return e.json()})).then((function(e){e.iceServers&&(e.iceServers.splice(3,1),console.log("iceServers",e.iceServers),S.iceServers=e.iceServers)}))},q=function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];arguments.length>1&&void 0!==arguments[1]&&arguments[1];t&&j?e="renegotiation_offer_to_user":t||(e="offer_to_user"),console.log("genOffer",t,j,e),e&&h.createOffer().then((function(t){h.setLocalDescription(t),O.emit(e,{targetUser:y,myID:n,offer:t,location:w}),document.getElementById("yourID").value=JSON.stringify(t)}))},Q=function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];arguments.length>1&&void 0!==arguments[1]&&arguments[1];t&&j?e="renegotiation_answer_to_user":t||(e="answer_to_user"),console.log("genAnswer",t,j,e),e&&(h.createAnswer().then((function(t){h.setLocalDescription(t),O.emit(e,{targetUser:y,answer:t,location:w}),document.getElementById("yourID").value=JSON.stringify(t)})),setTimeout((function(){H(!0)}),3e3))},X=function(){var e=Object(s.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!D){e.next=3;break}return alert("Already connecting/connected to user"),e.abrupt("return");case 3:return D=!0,y=t.target.innerText,e.next=7,navigator.mediaDevices.getUserMedia(k);case 7:v=e.sent,ee(),h=new RTCPeerConnection(S),v.getTracks().forEach((function(e){var t=h.addTrack(e,v);I.push(t)})),(E=h.createDataChannel("text",{ordered:!0,maxPacketLifeTime:3e3})).onopen=function(){console.log("DataChannel Open")},E.onmessage=oe,h.ontrack=te,h.onicecandidate=ne,h.onnegotiationneeded=re,q();case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Z=function(){var e=document.getElementById("yourMessage"),t=document.getElementById("messages");t.textContent=t.textContent+"Me: "+e.value+"\n------\n",t.scrollTop=t.scrollHeight,E.send(e.value),e.value=""},ee=function(){(p=document.getElementById("myVideo")).width=500,p.muted=!0;try{p.srcObject=v}catch(e){p.src=window.URL.createObjectURL(v)}K(!0)},te=function(e){(b=document.getElementById("theirVideo")).width=500,console.log(e);try{b.srcObject=e.streams[0]}catch(t){b.src=window.URL.createObjectURL(e.streams[0])}console.log(p.srcObject),console.log(b.srcObject)},ne=function(e){e.candidate&&O.emit("candidate",{candidate:e.candidate,targetUser:y})},oe=function(e){var t=document.getElementById("messages");t.textContent=t.textContent+e.data+"\n------\n",t.scrollTop=t.scrollHeight},ae=function(e){(E=e.channel).onopen=function(){console.log("DataChannel Open")},E.onmessage=oe,N(!0)},re=function(){var e=Object(s.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("here",t),q(!0,t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ce=function(){var e=Object(s.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Start ScreenShare"!==M){e.next=10;break}return e.next=3,navigator.mediaDevices.getDisplayMedia();case 3:t=e.sent,v.getTracks().forEach((function(e){"audio"!==e.kind||t.addTrack(e),e.stop()})),v=t,console.log(v.getTracks()),V("Start Video"),e.next=16;break;case 10:return e.next=12,navigator.mediaDevices.getUserMedia(k);case 12:n=e.sent,v.getTracks().forEach((function(e){e.stop()})),v=n,V("Start ScreenShare");case 16:console.log(v.getTracks()),console.log(h),(p=document.getElementById("myVideo")).width=500,p.muted=!0;try{p.srcObject=v}catch(o){p.src=window.URL.createObjectURL(v)}I.forEach((function(e){h.removeTrack(e)})),I=[],v.getTracks().forEach((function(e){var t=h.addTrack(e,v);I.push(t)})),console.log(h);case 26:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return a.a.createElement("div",{className:"App"},d.length>0?a.a.createElement(m,{users:d,handleUserClick:X}):null,G?a.a.createElement("button",{onClick:ce},M):a.a.createElement("button",null,"Welcome!"),a.a.createElement("br",null),a.a.createElement("button",{onClick:function(){h.getStats(null).then((function(e){return e.forEach((function(t){"candidate-pair"===t.type&&t.selected&&(console.log(t),"relayed"==t.candidateType?console.log("Uses TURN server: "+t.ipAddress):console.log("Does not use TURN (uses "+t.candidateType+")."),t.localCandidateId&&console.log("localCandidateId Get",e.get(t.localCandidateId)),t.remoteCandidateId&&console.log("remoteCandidateId Get",e.get(t.remoteCandidateId)))}))})),h.getStats(null).then((function(e){return e.forEach((function(e){"candidate-pair"===e.type&&console.log(e)}))})),console.log(h)}},"Get Stats"),a.a.createElement("br",null),x&&y?a.a.createElement(o.Fragment,null,a.a.createElement("strong",{id:"remote-user"},"Connected to: ",y),a.a.createElement("br",null),a.a.createElement("strong",{id:"remote-location"},"Location: ",x),a.a.createElement("br",null)):null,a.a.createElement("video",{id:"myVideo",autoPlay:!0}),a.a.createElement("spacer",{type:"block"}," "),a.a.createElement("video",{id:"theirVideo",autoPlay:!0}),a.a.createElement("br",null),a.a.createElement("br",null),R?a.a.createElement(o.Fragment,null,a.a.createElement("label",null,"Enter message"),a.a.createElement("br",null),a.a.createElement("input",{id:"yourMessage",type:"text",style:{width:190,height:25,fontSize:16},onKeyUp:function(e){if("Enter"===e.key){var t=document.getElementById("yourMessage");t.value=t.value,Z()}}}),a.a.createElement("button",{id:"send",onClick:Z},"Send"),a.a.createElement("pre",{id:"messages",style:{maxHeight:150,overflowY:"scroll"}})," ",a.a.createElement("br",null)):null,a.a.createElement("label",null,"Your ID:"),a.a.createElement("br",null),a.a.createElement("textarea",{id:"yourID"}),a.a.createElement("br",null),a.a.createElement("label",null,"Other ID:"),a.a.createElement("br",null),a.a.createElement("textarea",{id:"otherID"}),a.a.createElement("br",null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(a.a.createElement(C,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[31,1,2]]]);
//# sourceMappingURL=main.ba90726c.chunk.js.map