(this["webpackJsonpwebrtc-practice-site"]=this["webpackJsonpwebrtc-practice-site"]||[]).push([[0],{30:function(e,t,n){e.exports=n(68)},35:function(e,t,n){},37:function(e,t,n){},65:function(e,t){},68:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(28),c=n.n(r),l=(n(35),n(5)),i=n.n(l),s=n(12),u=n(2),m=(n(37),n(29));function d(e){var t=e.users,n=e.handleUserClick,a=t.map((function(e){return o.a.createElement("li",{onClick:n},e)}));return o.a.createElement("div",null,o.a.createElement("ul",{style:{listStyleType:"none"}},a))}var f,g,E,b,h,y,v,p=n.n(m)()(window.location.origin.replace(/^http/,"ws")),w={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",username:"webrtc@live.com",credential:"muazkh"}]};var O=function(){var e=Object(a.useState)(null),t=Object(u.a)(e,2),n=t[0],r=t[1],c=Object(a.useState)([]),l=Object(u.a)(c,2),m=l[0],O=l[1],I=Object(a.useState)(null),j=Object(u.a)(I,2),D=j[0],k=j[1],C=Object(a.useState)(!1),x=Object(u.a)(C,2),S=x[0],U=x[1],B=Object(a.useState)(!1),T=Object(u.a)(B,2),_=(T[0],T[1],Object(a.useState)(!1)),R=Object(u.a)(_,2),J=(R[0],R[1]);Object(a.useEffect)((function(){fetch("https://geolocation-db.com/json/").then((function(e){return e.json()})).then((function(e){console.log(e);var t=e.state?"".concat(e.state,", ").concat(e.country_name):"".concat(e.country_name);v=t})),p.on("get_id",(function(e){console.log("Connected to websocket"),r(e.myID),O(e.users)}))}),[]),Object(a.useEffect)((function(){n&&(p.on("new_person",(function(e){O(e.filter((function(e){return e!==n})))})),p.on("remove_user",(function(e){O(e.filter((function(e){return e!==n})))})),p.on("incoming_offer",function(){var e=Object(s.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Incoming offer from ".concat(t.offersID,": ").concat(JSON.stringify(t.offer))),console.log(t),h=t.offersID,k(t.location),e.next=6,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 6:g=e.sent,M(),f=new RTCPeerConnection(w),g.getTracks().forEach((function(e){return f.addTrack(e,g)})),f.ondatachannel=z,f.setRemoteDescription(t.offer),f.ontrack=P,f.onicecandidate=V,f.createAnswer().then((function(e){f.setLocalDescription(e),p.emit("answer_to_user",{targetUser:t.offersID,answer:e,location:v}),document.getElementById("yourID").value=JSON.stringify(e)})),document.getElementById("otherID").value=JSON.stringify(t.offer);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),p.on("incoming_answer",(function(e){console.log(e),k(e.location),console.log("Incoming answer: ".concat(JSON.stringify(e.answer))),f.setRemoteDescription(e.answer),document.getElementById("otherID").value=JSON.stringify(e.answer),console.log(f),U(!0)})),p.on("incoming_candidate",(function(e){console.log("candidate",e),f&&f.addIceCandidate(new RTCIceCandidate(e))})))}),[n]);var L=function(){var e=Object(s.a)(i.a.mark((function e(t){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.target.innerText,h=a,e.next=4,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 4:g=e.sent,M(),f=new RTCPeerConnection(w),g.getTracks().forEach((function(e){return f.addTrack(e,g)})),(y=f.createDataChannel("text",{ordered:!0,maxPacketLifeTime:3e3})).onopen=function(){console.log("DataChannel Open")},y.onmessage=H,f.ontrack=P,f.onicecandidate=V,f.createOffer().then((function(e){f.setLocalDescription(e),p.emit("offer_to_user",{targetUser:a,myID:n,offer:e,location:v}),document.getElementById("yourID").value=JSON.stringify(e)}));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),N=function(){var e=document.getElementById("yourMessage"),t=document.getElementById("messages");t.textContent=t.textContent+"Me: "+e.value+"\n------\n",t.scrollTop=t.scrollHeight,y.send(e.value),e.value=""},M=function(){(E=document.getElementById("myVideo")).width=500,E.muted=!0;try{E.srcObject=g}catch(e){E.src=window.URL.createObjectURL(g)}J(!0)},P=function(e){(b=document.getElementById("theirVideo")).width=500,console.log(e);try{b.srcObject=e.streams[0]}catch(t){b.src=window.URL.createObjectURL(e.streams[0])}console.log(E.srcObject),console.log(b.srcObject)},V=function(e){e.candidate&&p.emit("candidate",{candidate:e.candidate,targetUser:h})},H=function(e){var t=document.getElementById("messages");t.textContent=t.textContent+e.data+"\n------\n",t.scrollTop=t.scrollHeight},z=function(e){(y=e.channel).onopen=function(){console.log("DataChannel Open")},y.onmessage=H,U(!0)};return o.a.createElement("div",{className:"App"},m.length>0?o.a.createElement(d,{users:m,handleUserClick:L}):null,o.a.createElement("button",null,"Users"),o.a.createElement("br",null),D&&h?o.a.createElement(a.Fragment,null,o.a.createElement("strong",{id:"remote-user"},"Connected to: ",h),o.a.createElement("br",null),o.a.createElement("strong",{id:"remote-location"},"Location: ",D),o.a.createElement("br",null)):null,o.a.createElement("video",{id:"myVideo",autoPlay:!0}),o.a.createElement("spacer",{type:"block"}," "),o.a.createElement("video",{id:"theirVideo",autoPlay:!0}),o.a.createElement("br",null),o.a.createElement("br",null),S?o.a.createElement(a.Fragment,null,o.a.createElement("label",null,"Enter message"),o.a.createElement("br",null),o.a.createElement("input",{id:"yourMessage",type:"text",style:{width:190,height:25,fontSize:16},onKeyUp:function(e){if("Enter"===e.key){var t=document.getElementById("yourMessage");t.value=t.value,N()}}}),o.a.createElement("button",{id:"send",onClick:N},"Send"),o.a.createElement("pre",{id:"messages",style:{maxHeight:150,overflowY:"scroll"}})," ",o.a.createElement("br",null)):null,o.a.createElement("label",null,"Your ID:"),o.a.createElement("br",null),o.a.createElement("textarea",{id:"yourID"}),o.a.createElement("br",null),o.a.createElement("label",null,"Other ID:"),o.a.createElement("br",null),o.a.createElement("textarea",{id:"otherID"}),o.a.createElement("br",null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(o.a.createElement(O,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[30,1,2]]]);
//# sourceMappingURL=main.ff03e31d.chunk.js.map