{"version":3,"sources":["components/UserList.js","newestAttempt.js","serviceWorker.js","index.js"],"names":["UserList","props","users","handleUserClick","listElements","map","user","key","onClick","style","cursor","listStyleType","console","log","window","location","origin","peerConnection","myStream","localVideo","remoteVideo","targetUser","dataChannel","myLocation","socket","openSocket","replace","streamSenders","pcConfig","constraints","video","audio","allowRenegotionationOutsideVar","connectedToUser","App","useState","myID","setMyID","setUsers","remoteLocation","setRemoteLocation","showTextInput","setShowTextInput","screenShareBtnText","setScreenShareBtnText","allowRenegotionation","setAllowRenegotiation","setReadyToInitialize","useEffect","fetch","then","res","json","data","state","country_name","fetchIceServers","setInterval","on","filter","userID","a","offersID","JSON","stringify","offer","navigator","mediaDevices","getUserMedia","setStream","RTCPeerConnection","getTracks","forEach","track","sender","addTrack","push","ondatachannel","receiveDataChannel","setRemoteDescription","ontrack","receivedStream","onicecandidate","sendIceCandidate","onnegotiationneeded","handleNegotiation","generateAnswer","document","getElementById","value","answer","setTimeout","candidate","addIceCandidate","RTCIceCandidate","iceServers","splice","generateOffer","socketRoute","renegotiation","createOffer","setLocalDescription","emit","createAnswer","e","alert","target","innerText","createDataChannel","ordered","maxPacketLifeTime","onopen","onmessage","dataChannelMessage","sendTextMessage","textarea","messagesContainer","textContent","scrollTop","scrollHeight","send","width","muted","srcObject","error","src","URL","createObjectURL","event","streams","channel","handleScreenShare","getDisplayMedia","tempMyStream","kind","stop","removeTrack","className","length","getStats","stats","obj","type","selected","candidateType","ipAddress","get","id","autoPlay","height","fontSize","onKeyUp","maxHeight","overflowY","Boolean","hostname","match","ReactDOM","render","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.ba90726c.chunk.js","sourcesContent":["import React from 'react'\n\nexport default function UserList(props) {\n    const {users, handleUserClick} = props\n\n    const listElements = users.map((user) => {\n        return <li key={user} onClick={handleUserClick} style={{cursor: \"pointer\"}}>{user}</li>\n    })\n\n    return (\n        <div>\n            <ul style={{listStyleType: \"none\"}}>\n                {listElements}\n            </ul>\n        </div>\n    )\n}\n","import React, { useEffect, useState, Fragment } from 'react';\nimport './App.css';\nimport openSocket from 'socket.io-client';\nimport UserList from './components/UserList'\nimport { setInterval } from 'timers';\n// const port = process.env.PORT || 8000;\n\n// console.log(`ws://${window.location.hostname}:${port}`)\nconsole.log(`${window.location.origin}`)\nvar socket = openSocket(window.location.origin.replace(/^http/, 'ws'));\nvar peerConnection\nvar myStream\nvar streamSenders = []\nvar localVideo\nvar remoteVideo\nvar pcConfig = {\n    'iceServers': [{\"urls\": \"stun:stun.l.google.com:19302\"},\n    {\"urls\":\"turn:numb.viagenie.ca\", \"username\":\"webrtc@live.com\", \"credential\":\"muazkh\"}]\n  };\nvar constraints = { video: true, audio: true };\nvar targetUser\nvar dataChannel\nvar myLocation\nvar allowRenegotionationOutsideVar = false\nvar connectedToUser = false\n\nfunction App() {\n    const [myID, setMyID] = useState(null)\n    const [users, setUsers] = useState([])\n    const [remoteLocation, setRemoteLocation] = useState(null)\n    const [showTextInput, setShowTextInput] = useState(false)\n    const [screenShareBtnText, setScreenShareBtnText] = useState(\"Start ScreenShare\")\n    var [allowRenegotionation, setAllowRenegotiation] = useState(false)\n    const [streamInitialized, setStreamInitialized] = useState(false)\n    const [readyToInitialize, setReadyToInitialize] = useState(false)\n\n\n    useEffect(() => {\n\n        fetch(\"https://geolocation-db.com/json/\")\n        .then(res => res.json())\n        .then(data => {\n            console.log(data)\n            const location = data.state ? `${data.state}, ${data.country_name}` : `${data.country_name}`\n            myLocation = location})\n        \n        fetchIceServers()\n\n        setInterval(() => {\n            fetchIceServers()\n        }, 3470000)\n\n        socket.on('get_id', data => {\n            console.log(\"Connected to websocket\")\n            setMyID(data.myID)\n            setUsers(data.users)\n        })\n\n    }, [])\n\n    useEffect(() => {\n        if (myID) {\n            socket.on('new_person', data => {\n                setUsers(data.filter((userID => {\n                    return userID !== myID\n                })))\n            })\n\n            socket.on('remove_user', (data) => {\n                setUsers(data.filter((userID => {\n                    return userID !== myID\n                })))\n            })\n\n            socket.on('incoming_offer', async(data) => {\n                console.log(`Incoming offer from ${data.offersID}: ${JSON.stringify(data.offer)}`)\n                targetUser = data.offersID\n                setRemoteLocation(data.location)\n\n                myStream = await navigator.mediaDevices.getUserMedia(constraints);\n                setStream()\n                peerConnection = new RTCPeerConnection(pcConfig)\n                myStream.getTracks().forEach((track) => {\n                    let sender = peerConnection.addTrack(track, myStream)\n                    streamSenders.push(sender)\n                })\n                peerConnection.ondatachannel = receiveDataChannel\n                // dataChannel = peerConnection.createDataChannel('text', {\n                //     ordered: true, // guarantees order\n                //     maxPacketLifeTime: 3000\n                //   })\n                // dataChannel.onopen = () => {console.log(\"DataChannel Open\")}\n                // dataChannel.onmessage = dataChannelMessage\n                peerConnection.setRemoteDescription(data.offer)\n                peerConnection.ontrack = receivedStream\n                peerConnection.onicecandidate = sendIceCandidate\n                peerConnection.onnegotiationneeded = handleNegotiation\n                generateAnswer(false)\n\n                document.getElementById('otherID').value = JSON.stringify(data.offer)\n                // setStreamInitialized(true)\n            })\n\n            socket.on('incoming_answer', function (data) {\n                connectedToUser = true\n                setRemoteLocation(data.location)\n                console.log(`Incoming answer: ${JSON.stringify(data.answer)}`)\n                peerConnection.setRemoteDescription(data.answer)\n                document.getElementById('otherID').value = JSON.stringify(data.answer)\n                console.log(peerConnection)\n                setShowTextInput(true)\n                setTimeout(() => {\n                    setAllowRenegotiation(true)\n                }, 3000)\n                // setStreamInitialized(true)\n            })\n\n            socket.on(\"incoming_candidate\", function (candidate){\n                console.log(\"candidate\", candidate)\n                if (peerConnection) {\n                    peerConnection.addIceCandidate(new RTCIceCandidate(candidate))\n                }\n            })\n\n            socket.on(\"incoming_renegotiation_offer\", function(data){\n                console.log(data)\n                console.log(peerConnection)\n                peerConnection.setRemoteDescription(data.offer)\n                generateAnswer(true, data)\n                document.getElementById('otherID').value = JSON.stringify(data.offer)\n            })\n\n            socket.on(\"incoming_renegotiation_answer\", function(data){\n                console.log(data)\n                peerConnection.setRemoteDescription(data.answer)\n                document.getElementById('otherID').value = JSON.stringify(data.answer)\n            })\n        }\n    }, [myID])\n\n    useEffect(() => {\n        if (allowRenegotionation) {\n            allowRenegotionationOutsideVar = true\n        }\n    }, [allowRenegotionation])\n\n    const fetchIceServers = () => {\n        fetch(`${window.location.origin}/ice_servers`)\n        .then(res => res.json())\n        .then(data => {\n            if (data.iceServers) {\n                data.iceServers.splice(3,1)\n                console.log(\"iceServers\", data.iceServers)\n                pcConfig['iceServers'] = data.iceServers\n            }\n        })\n    }\n\n    const generateOffer = (renegotiation = false, data = false) => {\n        let socketRoute\n        if (renegotiation && allowRenegotionationOutsideVar) {\n            socketRoute = 'renegotiation_offer_to_user'\n        } else if (!renegotiation) {\n            socketRoute = 'offer_to_user'\n        }\n\n        console.log(\"genOffer\", renegotiation, allowRenegotionationOutsideVar, socketRoute)\n\n        if (socketRoute) {\n            peerConnection.createOffer().then((offer) => {\n                peerConnection.setLocalDescription(offer)\n                socket.emit(socketRoute, {\n                    targetUser: targetUser,\n                    myID: myID,\n                    offer: offer,\n                    location: myLocation\n                })\n                document.getElementById('yourID').value = JSON.stringify(offer)\n            })\n        }\n    }\n\n    const generateAnswer = (renegotiation = false, data = false) => {\n        let socketRoute\n        if (renegotiation && allowRenegotionationOutsideVar) {\n            socketRoute = 'renegotiation_answer_to_user'\n        } else if (!renegotiation) {\n            socketRoute = 'answer_to_user'\n        }\n\n        console.log(\"genAnswer\", renegotiation, allowRenegotionationOutsideVar, socketRoute)\n\n        if (socketRoute) {\n            peerConnection.createAnswer().then((answer) => {\n                peerConnection.setLocalDescription(answer)\n                socket.emit(socketRoute, {\n                    targetUser: targetUser,\n                    answer: answer,\n                    location: myLocation\n                })\n                document.getElementById('yourID').value = JSON.stringify(answer)\n            })\n            setTimeout(() => {\n                setAllowRenegotiation(true)\n            }, 3000)\n        }\n    } \n\n    const handleUserClick = async(e) => {\n        \n        if (connectedToUser) {alert(\"Already connecting/connected to user\"); return;}\n        \n        connectedToUser = true\n\n        targetUser = e.target.innerText\n\n        myStream = await navigator.mediaDevices.getUserMedia(constraints);\n        setStream()\n        peerConnection = new RTCPeerConnection(pcConfig)\n        myStream.getTracks().forEach((track) => {\n            let sender = peerConnection.addTrack(track, myStream)\n            streamSenders.push(sender)\n        })\n        dataChannel = peerConnection.createDataChannel('text', {\n            ordered: true, // guarantees order\n            maxPacketLifeTime: 3000\n          })\n        dataChannel.onopen = () => {console.log(\"DataChannel Open\")}\n        dataChannel.onmessage = dataChannelMessage\n        peerConnection.ontrack = receivedStream\n        peerConnection.onicecandidate = sendIceCandidate\n        peerConnection.onnegotiationneeded = handleNegotiation\n\n        generateOffer()\n\n    }\n\n    const hasUserMedia = () => { \n        //check if the browser supports the WebRTC \n        return !!(navigator.getUserMedia || navigator.webkitGetUserMedia || \n           navigator.mozGetUserMedia); \n      } \n\n    const sendTextMessage = () => {\n        const textarea = document.getElementById('yourMessage')\n        let messagesContainer = document.getElementById('messages')\n\n        messagesContainer.textContent = messagesContainer.textContent + \"Me: \" + textarea.value + \"\\n\" + \"------\\n\"\n        messagesContainer.scrollTop = messagesContainer.scrollHeight;\n        dataChannel.send(textarea.value)\n        textarea.value = \"\"\n    }\n\n    const handleTextAreaEnter = (event) => {\n        if (event.key === \"Enter\") {\n            const textarea = document.getElementById('yourMessage')\n            textarea.value = textarea.value\n            sendTextMessage()\n        }\n    }\n    \n    const setStream = () => {\n        localVideo = document.getElementById('myVideo'); \n        localVideo.width = 500\n        localVideo.muted = true\n        try {\n            localVideo.srcObject = myStream;\n        } catch (error) {\n            localVideo.src = window.URL.createObjectURL(myStream);\n        }\n\n        setReadyToInitialize(true)\n    }\n\n    const receivedStream = (event) => {\n        remoteVideo = document.getElementById('theirVideo')\n        remoteVideo.width = 500\n\n        console.log(event)\n        try {\n            remoteVideo.srcObject = event.streams[0];\n        } catch (error) {\n            remoteVideo.src = window.URL.createObjectURL(event.streams[0]);\n        }\n        \n        console.log(localVideo.srcObject)\n        console.log(remoteVideo.srcObject)\n    }\n\n    const sendIceCandidate = (event) => {\n        if (event.candidate) {\n            socket.emit('candidate', {candidate: event.candidate, targetUser: targetUser})\n        }\n    }\n\n    const dataChannelMessage = (event) => {\n        let messagesContainer = document.getElementById('messages')\n        messagesContainer.textContent = messagesContainer.textContent + event.data + \"\\n\" + \"------\\n\"\n        messagesContainer.scrollTop = messagesContainer.scrollHeight;\n    }\n\n    const receiveDataChannel = (event) => {\n        dataChannel = event.channel\n        dataChannel.onopen = () => {console.log(\"DataChannel Open\")}\n        dataChannel.onmessage = dataChannelMessage\n        setShowTextInput(true)\n    }\n\n    // const handleTrack = (event) => {\n    //     remoteVideo = document.getElementById('theirVideo')\n    //     remoteVideo.width = 500\n    //     console.log(event)\n    //     if (event.streams && event.streams[0]) {\n    //         remoteVideo.srcObject = event.streams[0];\n    //     } else {\n    //         let inboundStream = new MediaStream(event.track[0]);\n    //         remoteVideo.srcObject = inboundStream;\n    //     }\n    // }\n\n    const handleNegotiation = async (event) => {\n        console.log(\"here\", event)\n        generateOffer(true, event)\n    }\n\n    const handleScreenShare = async () => {\n        \n        if (screenShareBtnText === \"Start ScreenShare\") {\n            let tempMyStream = await navigator.mediaDevices.getDisplayMedia()\n            myStream.getTracks().forEach((track) => {\n                if (track.kind !== \"audio\") {\n                    track.stop()\n                } else {\n                    tempMyStream.addTrack(track)\n                    track.stop()\n                }\n            })\n            myStream = tempMyStream\n            console.log(myStream.getTracks())\n            setScreenShareBtnText(\"Start Video\")\n        } else {\n            let tempMyStream = await navigator.mediaDevices.getUserMedia(constraints);\n            myStream.getTracks().forEach((track) => {\n                track.stop()\n            })\n            myStream = tempMyStream\n            setScreenShareBtnText(\"Start ScreenShare\")\n        }\n        console.log(myStream.getTracks())\n        console.log(peerConnection)\n\n        localVideo = document.getElementById('myVideo'); \n        localVideo.width = 500\n        localVideo.muted = true\n        try {\n            localVideo.srcObject = myStream;\n        } catch (error) {\n            localVideo.src = window.URL.createObjectURL(myStream);\n        }\n    \n\n        streamSenders.forEach((sender) => {\n            peerConnection.removeTrack(sender)\n        })\n\n        streamSenders = []\n\n        myStream.getTracks().forEach((track) => {\n           let sender = peerConnection.addTrack(track, myStream)\n           streamSenders.push(sender)\n        })\n\n        console.log(peerConnection)\n\n    }\n\n    const handleGetStats = () => {\n        peerConnection.getStats(null)\n        .then(stats => stats.forEach(obj => {\n            if(obj.type === \"candidate-pair\" && obj.selected) {\n                console.log(obj);\n                if (obj.candidateType == \"relayed\") {\n                    console.log(\"Uses TURN server: \" + obj.ipAddress);\n                  } else {\n                    console.log(\"Does not use TURN (uses \" + obj.candidateType + \").\");\n                  }\n                \n                  if (obj[\"localCandidateId\"]){\n                    console.log(\"localCandidateId Get\", stats.get(obj[\"localCandidateId\"]))\n                }\n                if (obj[\"remoteCandidateId\"]){\n                    console.log(\"remoteCandidateId Get\", stats.get(obj[\"remoteCandidateId\"]));\n                }\n            }\n        })\n      )\n        peerConnection.getStats(null)\n            .then(stats => stats.forEach(obj => {\n                if(obj.type === \"candidate-pair\"){\n                    console.log(obj)\n                }\n            })\n        )\n\n        console.log(peerConnection)\n    }\n\n    return (\n        <div className=\"App\">\n\n            {users.length > 0 ? <UserList users={users} handleUserClick={handleUserClick}></UserList> : null}\n\n            {allowRenegotionation ? <button onClick={handleScreenShare}>{screenShareBtnText}</button> : <button>Welcome!</button>}<br/>\n            <button onClick={handleGetStats}>Get Stats</button><br/>\n            \n            {remoteLocation && targetUser ? \n            <Fragment>\n                <strong id=\"remote-user\">Connected to: {targetUser}</strong><br/>\n                <strong id=\"remote-location\">Location: {remoteLocation}</strong><br/>\n            </Fragment> : null\n            }\n    \n            <video id=\"myVideo\" autoPlay></video>\n            <spacer type=\"block\"> </spacer>\n            <video id=\"theirVideo\" autoPlay></video>\n            <br></br>\n            <br></br>\n            { showTextInput ? \n            <Fragment>\n            <label>Enter message</label><br />\n            <input id=\"yourMessage\" type=\"text\" style={{width: 190, height: 25, fontSize: 16}} onKeyUp={handleTextAreaEnter}></input>\n            <button id=\"send\" onClick={sendTextMessage}>Send</button>\n            <pre id=\"messages\" style={{maxHeight: 150, overflowY: \"scroll\"}}></pre> <br />\n            </Fragment>\n            : null\n            }\n            \n            <label>Your ID:</label><br />\n            <textarea id=\"yourID\"></textarea><br />\n            <label>Other ID:</label><br />\n            <textarea id=\"otherID\"></textarea><br />\n\n        </div>\n    );\n}\n\nexport default App;","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\n// import App from './App';\nimport App from './newestAttempt'\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}